<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Motor Wars 2 Original | Players</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div class="container">

  <!-- Sidebar -->
  <aside class="sidebar">
    <h2>Motor Wars 2 Original</h2>

    <div class="category">
      <h3>Search & Analyze</h3>
      <button class="side-btn active">Players</button>
      <!-- ✅ ADDED Active Players (Players button unchanged) -->
      <button class="side-btn sub">Active Players</button>
      <button class="side-btn">Clans</button>
    </div>

    <div class="category">
      <h3>Scores & Ranking</h3>
      <button class="side-btn">Nostalgia Night</button>
    </div>

    <div class="category">
      <h3>Analytics</h3>
      <button class="side-btn">Statistics</button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main">

    <!-- Search bar -->
    <div class="top-bar">
      <input type="text" placeholder="Search for a player or clan..." />
      <button class="search-btn">Search Player</button>
      <button class="search-btn secondary">Search Clan</button>
    </div>

    <!-- Player Table -->
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Country</th>
            <th>Player</th>
            <th>Xp</th>
            <th>Join Date</th>
            <th>Last Online</th>
            <th>Clan</th>
          </tr>
        </thead>
        <tbody id="playerTableBody">
          <tr><td colspan="7">Loading players...</td></tr>
        </tbody>
      </table>
    </div>

  </main>
</div>

<script>
  const API_URL = 'https://mainserver.serv00.net/API/players.php';

  // Mapping API fields to frontend table columns
  function mapPlayerData(player) {
    return {
      country: player.country || 'N/A',
      username: player.nickname || 'Unknown',
      xp: player.honor_points || 0,
      join_date: player.registration_date || 'N/A',
      last_online: player.last_login,
      clan: player.clan || '-'
    };
  }

  async function loadPlayers() {
    const tbody = document.getElementById('playerTableBody');

    try {
      const response = await fetch(API_URL);
      const playersRaw = await response.json();

      tbody.innerHTML = '';

      // ✅ ONLY players with NON-NULL last_login
      const activePlayers = playersRaw.filter(p =>
        p.last_login !== null &&
        p.last_login !== undefined &&
        p.last_login !== ''
      );

      if (activePlayers.length === 0) {
        tbody.innerHTML =
          '<tr><td colspan="7">No active players found.</td></tr>';
        return;
      }

      activePlayers.forEach((playerRaw, index) => {
        const player = mapPlayerData(playerRaw);

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${player.country}</td>
          <td>${player.username}</td>
          <td>${player.xp}</td>
          <td>${player.join_date}</td>
          <td>${player.last_online}</td>
          <td>${player.clan}</td>
        `;
        tbody.appendChild(tr);
      });

    } catch (err) {
      console.error('Error loading players:', err);
      tbody.innerHTML =
        '<tr><td colspan="7">Failed to load player data.</td></tr>';
    }
  }

  window.addEventListener('DOMContentLoaded', loadPlayers);
</script>

</body>
</html>
